# MD-WBS記述マニュアル ＆ ガントチャート生成ガイド (v5 - ID見出し化対応)

## 1. はじめに

このマニュアルは、プロジェクトの計画を立てる際に役立つ「MD-WBS (Markdown-based Work Breakdown Structure)」の記述方法と、それを利用して「Markwhen形式のガントチャート（タイムライン）」を自動生成する方法を解説します。

この手法では、Markdownというシンプルなテキスト記述ルールを使ってプロジェクトの全作業を階層的に定義し、PowerShellスクリプトによって視覚的なタイムラインに変換します。特別な専門知識は不要で、普段お使いのテキスト`エディタ`（とくにVisual Studio Code推奨）でプロジェクト計画を進めることができます。

## 2. WBSとガントチャートについて (再確認)

（このセクションの内容は前回と同様です。WBSとガントチャートの基本的な定義と役割について説明します。ここでは省略しますので、前回のマニュアルの「2. WBSとガントチャートって何？」をご参照ください。）

## 3. MD-WBS (新仕様) の記述方法

MD-WBSは、Markdown形式で記述します。VS Codeなどのテキスト`エディタ`で `.md` という拡張子のファイルを作成し、編集します。

### 3.1. ファイル全体の構造

MD-WBSファイルは、大きく分けて以下の2つの部分から構成されます。

1. **YAMLフロントマター (ファイルの先頭):** プロジェクト全体のメタ情報を記述します。
2. **Markdown本文:** プロジェクトの具体的なWBS（セクション、グループ、タスク、サブタスク）をMarkdownの見出しとリストを使って階層的に記述します。

### 3.2. YAMLフロントマター (プロジェクトメタ情報)

ファイルの**一番最初**に、`---`（ハイフン3つ）で囲まれたブロック内に、以下のキーと値のペアでプロジェクト全体の情報を記述します。

```yaml
---
title: ServiceDev 新サービス開発プロジェクト (v6 - 矛盾解消＆テスト)
description: 次世代向け新サービスの開発プロジェクト。MD-WBS新仕様、矛盾解消、および依存関係テストケースを含む。
date: 2025-05-16 # プロジェクト定義日やドキュメント作成日など
projectstartdate: 2025-06-01 # プロジェクトの計画開始日 (任意)
projectoveralldeadline: 2026-04-15 # プロジェクト全体の最終締切日 (任意)
view: month # Markwhenのデフォルト表示ビュー (任意、例: month, week)
---
```

* **`title` (必須推奨):** プロジェクトの正式名称。Markwhenのタイトルになります。
* **`description` (任意):** プロジェクトの簡単な説明。Markwhenの説明文になります。
* **`date` (任意):** このMD-WBSを作成または最後に更新した日付など、参照用の日付。
* **`projectstartdate` (任意):** プロジェクト全体の計画上の開始日。祝日表示のフィルタリングなどに使われることがあります。
* **`projectoveralldeadline` (任意):** プロジェクト全体の最終目標締切日。祝日表示のフィルタリングなどに使われることがあります。
* **`view` (任意):** Markwhenで表示する際のデフォルトの期間単位（例: `month`, `week`, `day`）。指定がなければ `month` になることが多いです。

### 3.3. Markdown本文 (WBSの階層構造と属性)

YAMLフロントマターの後に、Markdownの見出しを使ってWBSの階層構造を記述します。**すべてのWBS要素（セクション、グループ、タスク、サブタスク）は見出しとして表現されます。**

#### 3.3.1. 見出しの基本ルール

* **階層的IDと要素名:** 各見出しは、必ず行頭に階層を示すID（例: `1.`, `1.1.`, `1.1.1.`）を記述し、半角スペースを1つ挟んで要素名（セクション名、グループ名、タスク名）を記述します。
  * `## 1. セクション名`（レベル2見出し）
  * `### 1.1. グループ名`（レベル3見出し）
  * `#### 1.1.1. タスク名`（レベル4見出し）
  * `##### 1.1.1.1. サブタスク名`（レベル5見出し）
* この階層的IDが、各WBS要素の一意な識別子となり、依存関係の指定 (`depends:`) に使用されます。

#### 3.3.2. 各要素の属性リスト

各見出し（セクション、グループ、タスク）が持つ詳細な情報（属性）は、その見出し行の**直後の行から、1段インデント（通常スペース4つ）されたMarkdownリスト**として記述します。

* 各属性は `- キーワード: 値` の形式で記述します。
* キーワードの末尾にはコロン `:` を付けます。
* 値の部分で `#` 以降はコメントとして扱われ、無視されます。
* 属性リストの前後に空行を入れると、Markdownソースの可読性が向上します。

**利用可能な属性キーワード (限定されています):**

* **`deadline`**: 要素の目標完了日またはタスクの締切日 (形式: `YYYY-MM-DD`)。**タスク要素では必須です。**
* **`duration`**: タスクの所要期間（営業日数）。数値の後に `d` を付けます (例: `5d`)。**タスク要素（期間を持つもの）では必須です。** セクションやグループには通常不要です。
* **`status`**: 要素の進捗状況 (例: `pending`, `inprogress`, `completed`)。Markwhenのタグになります。
* **`progress`**: タスクの進捗率 (例: `75%` または `75`)。Markwhenのタスク名に追記されます。
* **`assignee`**: 担当者または担当チーム名。Markwhenのタグになります。
* **`depends`**: この要素が依存する先行要素の階層的ID (例: `1.1.1`)。**単一依存を推奨します。**

#### 3.3.3. 要素の詳細説明 (Markdown本文)

各見出し要素（セクション、グループ、タスク）に関する詳細な説明やメモは、属性リストの後（または属性リストがない場合は見出しの直後）に、通常のMarkdownの段落テキストとして自由に記述できます。これらの説明は、Markwhenのノートとして表示されることがあります。

#### 3.3.4. MD-WBS記述例

```markdown
---
title: ServiceDev 新サービス開発プロジェクト (v6)
description: 次世代向け新サービスの開発プロジェクト。
date: 2025-05-16
projectstartdate: 2025-06-01
projectoveralldeadline: 2026-04-15
view: month
---

## 1. 企画・調査フェーズ
    - deadline: 2025-08-31 # このセクションの目標完了日
    - status: inprogress
    - assignee: 企画チーム

このフェーズでは、市場の動向を調査し、新サービスの基本的な企画を固めます。
ユーザーニーズの把握と競合との差別化が重要となります。

### 1.1. 市場調査グループ
    - deadline: 2025-07-25 # このグループの目標完了日
    - status: completed
    - assignee: 調査チーム

#### 1.1.1. 市場全体のトレンド分析
    - duration: 10d
    - deadline: 2025-06-15
    - status: completed
    - progress: 100%

最新の技術トレンドと消費者行動の変化を調査します。

#### 1.1.2. ターゲット顧客セグメント定義
    - duration: 7d
    - deadline: 2025-06-30
    - depends: 1.1.1
    - status: completed
    - progress: 100%

#### 1.1.3. 主要プレイヤーと提供価値の分析
    - duration: 8d
    - deadline: 2025-07-25 # MD-WBS修正: 1.1.3のdeadlineを先行タスク1.1.2の終了(2025-07-08)より後に
    - depends: 1.1.2
    - status: inprogress
    - progress: 60%

### 1.2. 競合分析グループ
    - deadline: 2025-08-08
    - status: inprogress
    - assignee: 調査チーム

#### 1.2.1. 競合製品Aの機能・価格調査
    - duration: 5d
    - deadline: 2025-08-01 # MD-WBS修正: 先行1.1.3の終了(2025-07-25)より後
    - depends: 1.1.3
    - status: inprogress
    - progress: 30%

#### 1.2.2. 競合製品Bのユーザーレビュー分析
    - duration: 5d
    - deadline: 2025-08-08
    - depends: 1.2.1
    - status: pending

#### 1.2.3. 技術的優位性と劣位性の評価
    - duration: 7d
    - deadline: 2025-08-19
    - depends: 1.2.2
    - status: pending

### 1.3. 企画書作成グループ
    - deadline: 2025-09-12
    - status: pending
    - assignee: 企画リード

#### 1.3.1. 企画骨子作成とレビュー
    - duration: 10d
    - deadline: 2025-08-30
    - depends: 1.2.3
    - status: pending

#### 1.3.2. 企画書詳細作成
    - duration: 10d
    - deadline: 2025-09-12
    - depends: 1.3.1
    - status: pending


## 2. 設計フェーズ
    - deadline: 2025-11-30
    - depends: 1. # セクション1全体に依存

### 2.1. 要件定義グループ
    - deadline: 2025-10-27 # MD-WBS修正: 2.1.2の終了日に合わせる
    - assignee: PM, 設計チーム

#### 2.1.1. ビジネス要件定義
    - duration: 10d
    - deadline: 2025-09-29 # MD-WBS修正: 先行1.3.2の終了(2025-09-12)より後、かつサブタスクを包含できるように
    - depends: 1.3.2
    - status: pending

このタスクでは、ビジネス上のゴールと主要な機能を定義します。
ステークホルダーへのヒアリングが重要です。

##### 2.1.1.1. ユーザーインタビュー実施 (3回)
    - duration: 5d
    - deadline: 2025-09-19 # MD-WBS修正: 親2.1.1のdeadlineより前、かつ先行1.3.2の終了より後
    - depends: 1.3.2
    - status: pending

##### 2.1.1.2. 要求仕様書作成
    - duration: 5d
    - deadline: 2025-09-27 # MD-WBS修正: 親2.1.1のdeadlineより前、かつ先行2.1.1.1の終了より後
    - depends: 2.1.1.1
    - status: pending

#### 2.1.2. システム要件定義
    - duration: 10d
    - deadline: 2025-10-14 # MD-WBS修正: 先行2.1.1の終了(2025-10-10)より後
    - depends: 2.1.1
    - status: pending

## 3. 依存関係テストセクション
    - deadline: 2026-04-15

### 3.1. 正常な依存関係テストグループ
    - deadline: 2026-03-31

#### 3.1.1. 先行タスクA (正常)
    - duration: 5d
    - deadline: 2026-03-10
    - status: pending

#### 3.1.2. 後続タスクB (正常)
    - duration: 5d
    - deadline: 2026-03-20
    - depends: 3.1.1
    - status: pending

### 3.2. 意図的な矛盾テストグループ
    - deadline: 2026-04-15

#### 3.2.1. 先行タスクX (矛盾テスト用)
    - duration: 7d
    - deadline: 2026-04-05
    - status: pending

#### 3.2.2. 後続タスクY (意図的に矛盾発生)
    - description: このタスクは先行タスクXの終了日より前に開始するようにdeadlineを設定しているため、警告が出るはず。
    - duration: 3d
    - deadline: 2026-04-01
    - depends: 3.2.1
    - status: pending

```

**Markmapでの表示について:**

* この新仕様では、Markmapは見出しの階層（セクション、グループ、タスク、サブタスク）をツリーとして表示します。
* 各見出し（ノード）に紐づく属性リスト（`- deadline: ...`など）は、Markmapの機能によります。そのノードの子ノードとして表示されるか、あるいはノートとして扱われ、ノードを選択した際に詳細が表示される形になることが期待されます。これにより、メインのWBSツリーは要素名とIDで構成され、比較的スッキリとした表示になります。

## 4. ガントチャートの自動生成 (Markwhen)

（このセクションの内容は基本的に前回と同様です。`md-wbs2gantt.ps1` スクリプトの実行方法、主要な`パラメータ`について説明します。ただし、`-ProjectTitle` `パラメータ`はYAMLフロントマターで指定するため、スクリプトのコマンドライン`パラメータ`からは削除されています。）

**スクリプトの実行方法 (例):**

```powershell
.\md-wbs2gantt.ps1 -WbsFilePath ".\ServiceDev.md" `
                   -OfficialHolidayFilePath ".\syukujitsu-utf8.csv" `
                   -CompanyHolidayFilePath ".\company_holidays.csv" `
                   -OutputFilePath ".\ServiceDev_output.mw" `
                   -OutputFormat "Markwhen" `
                   -MarkwhenHolidayDisplayMode "InRange"
```

**主要な`パラメータ`:**

* `-WbsFilePath`: あなたが作成したMD-WBSファイルのパス。
* `-OfficialHolidayFilePath`: 国民の祝日CSVファイルのパス。
* `-CompanyHolidayFilePath`（任意）: 会社独自の休日CSVファイルのパス。
* `-OutputFilePath`: 生成されるMarkwhenデータが書き込まれるファイル名。
* `-OutputFormat`: `"Markwhen"` を指定（現在はMarkwhenのみ正式サポート）。
* `-DateFormatPattern`（任意）: Markwhen内で使用する日付の書式 (デフォルト: "yyyy-MM-dd")。
* `-DefaultEncoding`（任意）: ファイルのエンコーディング (デフォルト: "UTF8")。
* `-MarkwhenHolidayDisplayMode`（任意）: Markwhen出力時の祝日表示モード ("All", "InRange", "None"。デフォルト: "InRange")。

スクリプトを実行すると、指定した出力ファイルにMarkwhen形式のタイムラインデータが生成されます。これをVS CodeのMarkwhen拡張機能などで開くと、視覚的なガントチャートとして確認できます。

## 5. 運用のヒント・注意点

* **IDの採番:** 階層的ID（例: `1.`, `1.1.`, `1.1.1.`）は手動で管理する必要があります。WBSの構成変更時には、IDの整合性にも注意してください。
* **属性リストのインデント:** 各見出し要素の属性リストは、必ずその見出しより**1段深くインデント**（スペース4つ推奨）してください。
* **キーワードの厳守:** 属性リストのキーワード（`deadline:`, `duration:`など）は、定義されたものを使用してください。
* **依存関係の警告:** スクリプトが依存関係の矛盾を警告として出力した場合、MD-WBSファイルの計画（`deadline`, `duration`, `depends`）を見直してください。
* **バックアップ:** MD-WBSファイルは重要な計画データですので、Gitなどでバージョン管理することを強く推奨します。

この新しいMD-WBS仕様とスクリプトを活用して、効率的で分かりやすいプロジェクト計画を作成してください。

---

**注記:** 上記MD-WBSサンプル内の日付は、依存関係の矛盾を解消するように調整したものです。実際の計算結果はスクリプトの実行と祝日リストに依存します。
